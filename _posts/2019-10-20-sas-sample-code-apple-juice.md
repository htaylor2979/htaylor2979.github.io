---
title: Predicting Survival of Bacterial Spores Using Logistic Regression in SAS
date: 2019-10-20 20:00:00 -04:00
permalink: predicting-survival-of-spores-logistic-regression-sas
published: false
categories:
- Machine Learning
tags:
- SAS
layout: post
---

One of my class projects in Fall 2018 was to predict the presence of live bacterial spores called  <i>Alicyclobacillus acidoterrestris</i> CRA7152 in pasteurized apple juice. This particular bacterial strain is resistant to the heat of pasteurization, and it is also responsible for the "off" taste that develops in refrigerated fruit juices, like those sold in cold cases at grocery stores. Though harmless, CRA7152 causes stores to loose money by shortening products' shelf life. 

Furtunately, a chemical called nisin reduces CRA7152's heat resistance so that more of the spores die when heated. Thus, my modeling goal was to use the following features to predict whether live spores would be found in the pasteurized juice:
<ul>
	<li>nisin (units were not provided with the dataset, but typical units would be IU nisin/ml of solution)</li>
	<li>pH of the apple juice</li>
	<li>temperature of pasteurization in degrees Celcius</li>
	<li>Brix, which is a measure of percent by weight of sugar solutions</li>
</ul>

Because the response variable was binary (where 1 = detection of live CRA7152 spores), I chose logistic regression to predict the probability that the spores would survive the heating process. 

### SAS code used in exploring the data
I wrote the following SAS code to explore the model features. Table 1 summarizes the descriptive stats that were generated by the "Introduce the Data" section of code. 

 ![Table 1 Summary Stats]({{ site.url }}/assets/img/nisin-apple-juice-dataset-stats-fewer-dec.jpg)

{% highlight sas %}
libname wk6 "/folders/myfolders/" ;

/***** Introduce the Data *****/

* Check the dataset file contents ;
proc contents data=wk6.apple_juice ;
	label ;
run ;

proc freq data=wk6.apple_juice ;
run ;

* Generate descriptive stats ;
ods graphics on;
proc univariate data = wk6.apple_juice 
	outtable = applej_stats  
	noprint	;
run;

* Print a short table of descriptive stats ;
title "Descriptive Stats for the Apple Juice Dataset" ;
proc print data = applej_stats
	noobs label ;
	var _VAR_ _NOBS_ _MIN_ _MEDIAN_ _MEAN_ _MAX_ _SKEW_ _NMISS_ ;
	label 
		_MIN_="Minimum" 
		_MAX_="Maximum" 
		_MEAN_="Mean" 
		_MEDIAN_="Median" 
		_SKEW_ = "Skew"
		_NMISS_="# of Missing Values" ;
run ;
{% endhighlight %}

### Logistic regression model
The project instructions directed us to fit five models. The first four used only one feature each, while the fifth model used all four features. To make my code more efficient, I create a macro for the modeling process and then passed in each of the four predictors as parameters. The instructions for the fifth model dictated a stepwise variable selection approach. Thus, the fifth model was given its own section of code. 

{% highlight sas %}
/***** Investigate Each Predictor *****/

/* Run Proc Logistic on the four predictors, one at a time. 
* Implement a macro to save coding */

%macro testgrowth(my_vars =, plots_wanted =,  ) ;
	title "Proc Logistic Output for Variable(s): &my_vars" ;
	ods graphics on ;
	proc logistic data=wk6.apple_juice
		plots = &plots_wanted. ;
		model growth (event='1') = &my_vars. ;
	run ;
%mend ;

/* Input: plots_wanted can be none, all, a list, or just one plot */
%testgrowth(my_vars = ph, plots_wanted = ROC) ;
%testgrowth(my_vars = nisin, plots_wanted = ROC) ;
%testgrowth(my_vars = temperature, plots_wanted = ROC) ;
%testgrowth(my_vars = brix, plots_wanted = ROC) ;
* %testgrowth(my_vars = ph nisin temperature brix, plots_wanted = ROC) ;

/* The model with all the variables gets its own code because 
*  the selection method was specified in the homework instructions. */
title "Proc Logistic Output for All Variables with Stepwise Selection Method" ;
	ods graphics on ;
proc logistic data=wk6.apple_juice
	plots = ROC ;
	model growth (event='1') = ph nisin temperature brix
		/selection=stepwise;
run ;
	
{% endhighlight %}

### The fifth and final model
A receiver operating characteristic (ROC) curve was printed for each model to determine how well it predicted the spores' survival. Among these, the first four models showed a noticeably smaller area under curve (AUC). Given that a larger AUC indicates an overall better true positive rate vs. false positive rate, the fifth model performed the best. Its ROC curve is pictured below.

![ROC of the final model]({{ site.url }}/assets/img/roc-curve-nisin-apple-juice-model-all-predictors.jpg)

### The equation of the final model
P(presence of live spores) = -7.2462 + 1.8859 * ph - 0.0663 * nisin + 0.1104 * temperature - 0.3117 * brix

