<p>One of my class projects in Fall 2018 was to predict the presence of live bacterial spores called  <i>Alicyclobacillus acidoterrestris</i> CRA7152 in pasteurized apple juice. This particular bacterial strain is resistant to the heat of pasteurization, and it is also responsible for the “off” taste that develops in refrigerated fruit juices, like those sold in cold cases at grocery stores. Though harmless, CRA7152 causes stores to loose money by shortening products’ shelf life.</p>

<p>Furtunately, a chemical called nisin reduces CRA7152’s heat resistance so that more of the spores die when heated. Thus, my modeling goal was to use the following features to predict whether live spores would be found in the pasteurized juice:</p>
<ul>
	<li>nisin (units were not provided with the dataset, but typical units would be IU nisin/ml of solution)</li>
	<li>pH of the apple juice</li>
	<li>temperature of pasteurization in degrees Celcius</li>
	<li>Brix, which is a measure of percent by weight of sugar solutions</li>
</ul>

<p>Because the response variable was binary (where 1 = detection of live CRA7152 spores), I chose logistic regression to predict the probability that the spores would survive the heating process.</p>

<h3 id="sas-code-used-in-exploring-the-data">SAS code used in exploring the data</h3>
<p>I wrote the following SAS code to explore the model features. Table 1 summarizes the descriptive stats that were generated by the “Introduce the Data” section of code.</p>

<p><img src="https://htaylor2979.github.io/assets/img/nisin-apple-juice-dataset-stats-fewer-dec.jpg" alt="Table 1 Summary Stats" /></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">	<span class="n">libname</span> <span class="n">wk6</span> <span class="s2">"/folders/myfolders/"</span> <span class="p">;</span>

	<span class="sr">/***** Introduce the Data *****/</span>

	<span class="o">*</span> <span class="no">Check</span> <span class="n">the</span> <span class="n">dataset</span> <span class="n">file</span> <span class="n">contents</span> <span class="p">;</span>
	<span class="nb">proc</span> <span class="n">contents</span> <span class="n">data</span><span class="o">=</span><span class="n">wk6</span><span class="p">.</span><span class="nf">apple_juice</span> <span class="p">;</span>
		<span class="n">label</span> <span class="p">;</span>
	<span class="n">run</span> <span class="p">;</span>

	<span class="nb">proc</span> <span class="n">freq</span> <span class="n">data</span><span class="o">=</span><span class="n">wk6</span><span class="p">.</span><span class="nf">apple_juice</span> <span class="p">;</span>
	<span class="n">run</span> <span class="p">;</span>

	<span class="o">*</span> <span class="no">Generate</span> <span class="n">descriptive</span> <span class="n">stats</span> <span class="p">;</span>
	<span class="n">ods</span> <span class="n">graphics</span> <span class="n">on</span><span class="p">;</span>
	<span class="nb">proc</span> <span class="n">univariate</span> <span class="n">data</span> <span class="o">=</span> <span class="n">wk6</span><span class="p">.</span><span class="nf">apple_juice</span> 
		<span class="n">outtable</span> <span class="o">=</span> <span class="n">applej_stats</span>  
		<span class="n">noprint</span>	<span class="p">;</span>
	<span class="n">run</span><span class="p">;</span>

	<span class="o">*</span> <span class="no">Print</span> <span class="n">a</span> <span class="n">short</span> <span class="n">table</span> <span class="n">of</span> <span class="n">descriptive</span> <span class="n">stats</span> <span class="p">;</span>
	<span class="n">title</span> <span class="s2">"Descriptive Stats for the Apple Juice Dataset"</span> <span class="p">;</span>
	<span class="nb">proc</span> <span class="nb">print</span> <span class="n">data</span> <span class="o">=</span> <span class="n">applej_stats</span>
		<span class="n">noobs</span> <span class="n">label</span> <span class="p">;</span>
		<span class="n">var</span> <span class="n">_VAR_</span> <span class="n">_NOBS_</span> <span class="n">_MIN_</span> <span class="n">_MEDIAN_</span> <span class="n">_MEAN_</span> <span class="n">_MAX_</span> <span class="n">_SKEW_</span> <span class="n">_NMISS_</span> <span class="p">;</span>
		<span class="n">label</span> 
			<span class="n">_MIN_</span><span class="o">=</span><span class="s2">"Minimum"</span> 
			<span class="n">_MAX_</span><span class="o">=</span><span class="s2">"Maximum"</span> 
			<span class="n">_MEAN_</span><span class="o">=</span><span class="s2">"Mean"</span> 
			<span class="n">_MEDIAN_</span><span class="o">=</span><span class="s2">"Median"</span> 
			<span class="n">_SKEW_</span> <span class="o">=</span> <span class="s2">"Skew"</span>
			<span class="n">_NMISS_</span><span class="o">=</span><span class="s2">"# of Missing Values"</span> <span class="p">;</span>
	<span class="n">run</span> <span class="p">;</span>
	</code></pre></figure>

<h3 id="logistic-regression-model">Logistic regression model</h3>
<p>The project instructions directed us to fit five models. The first four used only one feature each, while the fifth model used all four features. To make my code more efficient, I create a macro for the modeling process and then passed in each of the four predictors as parameters. The instructions for the fifth model dictated a stepwise variable selection approach. Thus, the fifth model was given its own section of code.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">	<span class="sr">/***** Investigate Each Predictor *****/</span>

	<span class="sr">/* Run Proc Logistic on the four predictors, one at a time. 
	* Implement a macro to save coding */</span>

	<span class="o">%</span><span class="n">macro</span> <span class="n">testgrowth</span><span class="p">(</span><span class="n">my_vars</span> <span class="o">=</span><span class="p">,</span> <span class="n">plots_wanted</span> <span class="o">=</span><span class="p">,</span>  <span class="p">)</span> <span class="p">;</span>
		<span class="n">title</span> <span class="s2">"Proc Logistic Output for Variable(s): &amp;my_vars"</span> <span class="p">;</span>
		<span class="n">ods</span> <span class="n">graphics</span> <span class="n">on</span> <span class="p">;</span>
		<span class="nb">proc</span> <span class="n">logistic</span> <span class="n">data</span><span class="o">=</span><span class="n">wk6</span><span class="p">.</span><span class="nf">apple_juice</span>
			<span class="n">plots</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">plots_wanted</span><span class="o">.</span> <span class="p">;</span>
			<span class="n">model</span> <span class="n">growth</span> <span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s1">'1'</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">my_vars</span><span class="o">.</span> <span class="p">;</span>
		<span class="n">run</span> <span class="p">;</span>
	<span class="o">%</span><span class="n">mend</span> <span class="p">;</span>

	<span class="sr">/* Input: plots_wanted can be none, all, a list, or just one plot */</span>
	<span class="o">%</span><span class="n">testgrowth</span><span class="p">(</span><span class="n">my_vars</span> <span class="o">=</span> <span class="n">ph</span><span class="p">,</span> <span class="n">plots_wanted</span> <span class="o">=</span> <span class="no">ROC</span><span class="p">)</span> <span class="p">;</span>
	<span class="o">%</span><span class="n">testgrowth</span><span class="p">(</span><span class="n">my_vars</span> <span class="o">=</span> <span class="n">nisin</span><span class="p">,</span> <span class="n">plots_wanted</span> <span class="o">=</span> <span class="no">ROC</span><span class="p">)</span> <span class="p">;</span>
	<span class="o">%</span><span class="n">testgrowth</span><span class="p">(</span><span class="n">my_vars</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">plots_wanted</span> <span class="o">=</span> <span class="no">ROC</span><span class="p">)</span> <span class="p">;</span>
	<span class="o">%</span><span class="n">testgrowth</span><span class="p">(</span><span class="n">my_vars</span> <span class="o">=</span> <span class="n">brix</span><span class="p">,</span> <span class="n">plots_wanted</span> <span class="o">=</span> <span class="no">ROC</span><span class="p">)</span> <span class="p">;</span>
	<span class="o">*</span> <span class="o">%</span><span class="n">testgrowth</span><span class="p">(</span><span class="n">my_vars</span> <span class="o">=</span> <span class="n">ph</span> <span class="n">nisin</span> <span class="n">temperature</span> <span class="n">brix</span><span class="p">,</span> <span class="n">plots_wanted</span> <span class="o">=</span> <span class="no">ROC</span><span class="p">)</span> <span class="p">;</span>

	<span class="sr">/* The model with all the variables gets its own code because 
	*  the selection method was specified in the homework instructions. */</span>
	<span class="n">title</span> <span class="s2">"Proc Logistic Output for All Variables with Stepwise Selection Method"</span> <span class="p">;</span>
	<span class="n">ods</span> <span class="n">graphics</span> <span class="n">on</span> <span class="p">;</span>
	<span class="nb">proc</span> <span class="n">logistic</span> <span class="n">data</span><span class="o">=</span><span class="n">wk6</span><span class="p">.</span><span class="nf">apple_juice</span>
		<span class="n">plots</span> <span class="o">=</span> <span class="no">ROC</span> <span class="p">;</span>
		<span class="n">model</span> <span class="n">growth</span> <span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s1">'1'</span><span class="p">)</span> <span class="o">=</span> <span class="n">ph</span> <span class="n">nisin</span> <span class="n">temperature</span> <span class="n">brix</span>
			<span class="sr">/selection=stepwise;
	run ;
	</span></code></pre></figure>

<h3 id="the-fifth-and-final-model">The fifth and final model</h3>
<p>A receiver operating characteristic (ROC) curve was printed for each model to determine how well it predicted the spores’ survival. Among these, the first four models showed a noticeably smaller area under curve (AUC). Given that a larger AUC indicates an overall better true positive rate vs. false positive rate, the fifth model performed the best. Its ROC curve is pictured below.</p>

<p><img src="https://htaylor2979.github.io/assets/img/roc-curve-nisin-apple-juice-model-all-predictors.jpg" alt="ROC of the final model" /></p>

<h3 id="the-equation-of-the-final-model">The equation of the final model</h3>
<p>P(presence of live spores) = -7.2462 + 1.8859 * ph - 0.0663 * nisin + 0.1104 * temperature - 0.3117 * brix</p>
